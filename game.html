<!doctype html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>臭迪遊戲區｜俄羅斯方塊</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; --link:#93c5fd; --border:rgba(255,255,255,.08); --container:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; line-height:1.6; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans TC','PingFang TC','Microsoft JhengHei',sans-serif; background:linear-gradient(120deg,#0b1220,#111827)}
    .container{max-width:var(--container); margin:0 auto; padding:0 16px}
    header{position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px); background:rgba(15,23,42,.75); border-bottom:1px solid var(--border); z-index:10}
    .nav{display:flex; align-items:center; justify-content:space-between; height:56px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 20px var(--accent)}
    nav ul{list-style:none; display:flex; gap:16px; padding:0; margin:0}
    nav a{display:inline-block; padding:6px 10px; border-radius:8px; text-decoration:none; color:var(--link); border:1px solid transparent}
    nav a:hover{border-color:var(--border); color:#fff}
    nav a.active{background:var(--accent); color:#052436; font-weight:700}
    .hero{padding:32px 0 12px}
    .hero h1{margin:0 0 6px; font-size:28px}
    .hero p{margin:0; color:var(--muted)}
    main{padding:12px 0 40px}
    .grid{display:grid; grid-template-columns: 1fr 300px; gap:20px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .game-wrap{padding:16px}
    .game-area{display:grid; grid-template-columns:auto 220px; gap:16px}
    @media (max-width:800px){ .game-area{grid-template-columns:1fr} }
    canvas{background:#0b1020; border-radius:12px; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
    .game-canvas-wrap{position:relative; width:240px; height:480px}
    .game-canvas-wrap canvas{position:absolute; left:0; top:0}
    .game-canvas-wrap .fx{pointer-events:none; mix-blend-mode:screen}
    .side{padding:12px 14px; border-radius:16px}
    .side h2{font-size:18px; margin:0 0 10px; color:#f8fafc}
    .stats{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:10px 0 12px}
    .stat{background:#0b1220; padding:10px; border-radius:10px; text-align:center}
    .stat b{display:block; font-size:22px; margin-top:2px; color:#fff}
    .controls{font-size:14px}
    .btns{display:flex; gap:8px; margin-top:10px}
    button{flex:1; padding:10px 12px; border:0; border-radius:10px; background:var(--accent); color:#052436; font-weight:700; cursor:pointer}
    button.secondary{background:#64748b; color:#0b1220}
    .next{display:grid; grid-template-columns:repeat(4,24px); grid-auto-rows:24px; gap:2px; justify-content:center; padding:8px; background:#0b1220; border-radius:10px; width:max-content; margin:6px auto}
    .sq{width:24px;height:24px;border-radius:4px}
    .note{opacity:.7; font-size:12px; margin-top:6px; text-align:center}
    .howto{padding:16px}
    .howto h3{margin:0 0 10px}
    .howto ul{margin:8px 0 0 16px; padding:0}
    footer{border-top:1px solid var(--border); color:var(--muted); padding:14px 0 34px; text-align:center}
    footer small{display:inline-block}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="dot"></span>遊戲區</div>
      <nav>
        <ul>
          <li><a href="home.html">首頁</a></li>
          <li><a class="active" href="#">俄羅斯方塊</a></li>
          <li><a href="game2.html">太空戰爭</a></li>
          <li><a href="game3.html">ZooKeeper</a></li>
          <li><a href="home2.html">登出</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h1>臭迪遊戲區｜俄羅斯方塊</h1>
      <p>← → 左右移動、↑ 旋轉、↓ 加速下落、Space 快速落下、C/H 保留、P 暫停、R 重開</p>
    </div>
  </section>

  <main class="container">
    <div class="grid">
      <section class="card game-wrap">
        <div class="game-area">
          <div class="game-canvas-wrap">
            <canvas id="game" width="240" height="480" class="panel"></canvas>
            <canvas id="fx" width="240" height="480" class="fx"></canvas>
          </div>
          <aside class="card side">
            <h2>狀態面板</h2>
            <div class="stats">
              <div class="stat">分數<b id="score">0</b></div>
              <div class="stat">等級<b id="level">1</b></div>
              <div class="stat">消行<b id="lines">0</b></div>
              <div class="stat">狀態<b id="state">準備</b></div>
            </div>
            <div>
              下一個：
              <div id="next" class="next"></div>
            </div>
            <div class="controls">
              <p><b>操作</b><br>
              ← → 左右移動　↑ 旋轉　↓ 加速下落　Space 快速落下<br>
              C/H 保留　P 暫停　R 重新開始</p>
            </div>
            <div class="btns">
              <button id="btnStart">開始</button>
              <button id="btnPause" class="secondary">暫停</button>
            </div>
            <div class="note">Made with HTML5 Canvas + WebAudio</div>
          </aside>
        </div>
      </section>

      <aside class="card howto">
        <h3>玩法與規則</h3>
        <ul>
          <li>棋盤 10×20，使用 7-Bag 隨機發磚。</li>
          <li>單/雙/三/四行消除對應加分，連線會升級加速。</li>
          <li>支援保留（Hold）、快速落下（Space）與鬼影預覽。</li>
          <li>支援重新開始（R）、暫停（P）。</li>
        </ul>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container">
      <small>by Paddy臭迪小胖子 ©</small>
    </div>
  </footer>

  <script>
  (function(){
    const COLS = 10, ROWS = 20, SIZE = 24;
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    ctx.scale(1,1);
    const fxCanvas = document.getElementById('fx');
    const fxctx = fxCanvas.getContext('2d');
    fxCanvas.width = canvas.width; fxCanvas.height = canvas.height;

    const elScore = document.getElementById('score');
    const elLevel = document.getElementById('level');
    const elLines = document.getElementById('lines');
    const elState = document.getElementById('state');
    const elNext = document.getElementById('next');
    document.getElementById('btnStart').addEventListener('click', start);
    document.getElementById('btnPause').addEventListener('click', togglePause);

    const COLORS = {0:'#0b1020',1:'#00f0f0',2:'#0000f0',3:'#f0a000',4:'#f0f000',5:'#00f000',6:'#a000f0',7:'#f00000'};
    const SHAPES = { I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]], J:[[2,0,0],[2,2,2],[0,0,0]], L:[[0,0,3],[3,3,3],[0,0,0]], O:[[4,4],[4,4]], S:[[0,5,5],[5,5,0],[0,0,0]], T:[[0,6,0],[6,6,6],[0,0,0]], Z:[[7,7,0],[0,7,7],[0,0,0]] };
    const TYPES = Object.keys(SHAPES);

    class Bag{ constructor(){this.bag=[];} next(){ if(this.bag.length===0){ this.bag=TYPES.slice(); shuffle(this.bag);} return this.bag.pop(); } }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

    let board, piece, bag, nextType, holdType=null, canHold=true;
    let dropCounter=0, dropInterval=1000; let lastTime=0, paused=false, over=false;
    let score=0, lines=0, level=1;

    // Web Audio 音效（瀏覽器需使用者互動後才會啟動）
    const AC = window.AudioContext || window.webkitAudioContext; const audio = AC? new AC(): null;
    function tone(freq=440, dur=0.07, type='sine', gain=0.04){ if(!audio) return; const t=audio.currentTime; const o=audio.createOscillator(); const g=audio.createGain(); o.type=type; o.frequency.value=freq; o.connect(g); g.connect(audio.destination); g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(gain,t+0.005); g.gain.exponentialRampToValueAtTime(0.0001,t+dur); o.start(t); o.stop(t+dur); }
    function chord(freqs=[], dur=0.12, type='sine', gain=0.035){ freqs.forEach(f=>tone(f,dur,type,gain)); }
    const sfx = { move:()=>tone(520,0.03,'square',0.02), rotate:()=>tone(680,0.05,'triangle',0.03), lock:()=>chord([220,330],0.08,'sawtooth',0.03), hard:()=>chord([130,196,261.6],0.06,'square',0.025), clear1:()=>chord([392],0.12,'triangle',0.04), clear2:()=>chord([392,523],0.14,'triangle',0.04), clear3:()=>chord([392,523,659],0.16,'triangle',0.04), clear4:()=>chord([392,523,659,784],0.2,'triangle',0.045)};

    // 視覺特效
    const particles=[];
    function addParticles(x,y,color,n=24,spread=1.6){ for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2; const sp=(Math.random()*1+0.5)*spread; particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-0.5,life:600,alpha:1,color}); } }
    function addRowShine(py){ particles.push({type:'shine',y:py,life:300,alpha:1}); }
    function addLandingFlash(cells){ cells.forEach(({x,y,v})=>addParticles(x*SIZE+SIZE/2,y*SIZE+SIZE/2,COLORS[v],10,1.2)); }
    function updateFx(delta){ fxctx.clearRect(0,0,fxCanvas.width,fxCanvas.height); for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; if(p.type==='shine'){ fxctx.globalAlpha=p.alpha*0.6; fxctx.fillStyle='#fff'; fxctx.fillRect(0,p.y,fxCanvas.width,4); p.life-=delta; p.alpha=Math.max(0,p.life/300); if(p.life<=0) particles.splice(i,1); continue; } p.x+=p.vx; p.y+=p.vy; p.vy+=0.04; p.life-=delta; p.alpha=Math.max(0,p.life/600); fxctx.globalAlpha=p.alpha; fxctx.fillStyle=p.color||'#fff'; fxctx.fillRect(p.x-2,p.y-2,4,4); if(p.life<=0) particles.splice(i,1);} fxctx.globalAlpha=1; }

    function reset(){ board=createMatrix(COLS,ROWS); bag=new Bag(); nextType=bag.next(); newPiece(); score=0; lines=0; level=1; dropInterval=1000; over=false; paused=false; updateUI(); elState.textContent='準備'; }
    function start(){ reset(); elState.textContent='遊戲中'; loop(0); }
    function togglePause(){ if(over) return; paused=!paused; elState.textContent=paused?'暫停':'遊戲中'; }
    function gameOver(){ over=true; elState.textContent='結束'; }

    function createMatrix(w,h){ const m=[]; while(h--) m.push(new Array(w).fill(0)); return m; }
    function rotate(matrix,dir){ for(let y=0;y<matrix.length;y++){ for(let x=0;x<y;x++){ [matrix[x][y],matrix[y][x]]=[matrix[y][x],matrix[x][y]]; } } if(dir>0){ matrix.forEach(row=>row.reverse()); } else { matrix.reverse(); } }
    function createPiece(type){ return SHAPES[type].map(r=>r.slice()); }

    function newPiece(){ const type=nextType; nextType=bag.next(); piece={matrix:createPiece(type), pos:{x:(COLS>>1)-2,y:0}, type}; canHold=true; if(collide(board,piece)){ gameOver(); } renderNext(); }
    function hold(){ if(!canHold||over||paused) return; const curType=piece.type; if(holdType==null){ holdType=curType; newPiece(); } else { [holdType,piece]=[curType,{matrix:createPiece(holdType),pos:{x:(COLS>>1)-2,y:0},type:holdType}]; if(collide(board,piece)) gameOver(); } canHold=false; }

    function collide(board,piece){ const m=piece.matrix,o=piece.pos; for(let y=0;y<m.length;y++){ for(let x=0;x<m[y].length;x++){ if(m[y][x]!==0 && (o.y+y>=ROWS || o.x+x<0 || o.x+x>=COLS || board[o.y+y]?.[o.x+x]!==0)) return true; } } return false; }
    function merge(board,piece){ piece.matrix.forEach((row,y)=>{ row.forEach((v,x)=>{ if(v!==0){ board[piece.pos.y+y][piece.pos.x+x]=v; } }); }); }

    function clearLines(){ let rowsCleared=0; const clearedRows=[]; outer: for(let y=ROWS-1;y>=0;y--){ for(let x=0;x<COLS;x++){ if(board[y][x]===0) continue outer; } clearedRows.push(y); const row=board.splice(y,1)[0].fill(0); board.unshift(row); rowsCleared++; y++; } if(rowsCleared>0){ const add=[0,100,300,500,800][rowsCleared]*level; score+=add; lines+=rowsCleared; if(lines>=level*10){ level++; dropInterval=Math.max(120,1000-(level-1)*80);} (rowsCleared===1 && sfx.clear1()) || (rowsCleared===2 && sfx.clear2()) || (rowsCleared===3 && sfx.clear3()) || (rowsCleared>=4 && sfx.clear4()); clearedRows.forEach((rowIndex)=>{ const py=rowIndex*SIZE+SIZE/2; addRowShine(py); for(let x=0;x<COLS;x++){ addParticles(x*SIZE+SIZE/2,rowIndex*SIZE+SIZE/2,'#ffffff',6,2);} }); updateUI(); } }

    function updateUI(){ elScore.textContent=score; elLevel.textContent=level; elLines.textContent=lines; }

    function drawCell(x,y,v){ if(v===0) return; const px=x*SIZE, py=y*SIZE; ctx.fillStyle=COLORS[v]; ctx.fillRect(px+1,py+1,SIZE-2,SIZE-2); ctx.globalAlpha=0.15; ctx.fillStyle="#fff"; ctx.fillRect(px+2,py+2,SIZE-6,6); ctx.globalAlpha=1; }
    function drawMatrix(matrix,offset){ for(let y=0;y<matrix.length;y++){ for(let x=0;x<matrix[y].length;x++){ const v=matrix[y][x]; if(v!==0){ drawCell(x+offset.x,y+offset.y,v); } } } }
    function drawBoard(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.globalAlpha=0.06; ctx.strokeStyle="#fff"; for(let x=0;x<=COLS;x++){ ctx.beginPath(); ctx.moveTo(x*SIZE,0); ctx.lineTo(x*SIZE,ROWS*SIZE); ctx.stroke(); } for(let y=0;y<=ROWS;y++){ ctx.beginPath(); ctx.moveTo(0,y*SIZE); ctx.lineTo(COLS*SIZE,y*SIZE); ctx.stroke(); } ctx.globalAlpha=1; for(let y=0;y<ROWS;y++) for(let x=0;x<COLS;x++) drawCell(x,y,board[y][x]); const ghost={matrix:piece.matrix.map(r=>r.slice()), pos:{x:piece.pos.x,y:piece.pos.y}}; while(!collide(board,{matrix:ghost.matrix,pos:{x:ghost.pos.x,y:ghost.pos.y+1},type:piece.type})) ghost.pos.y++; ctx.globalAlpha=0.25; drawMatrix(ghost.matrix,ghost.pos); ctx.globalAlpha=1; drawMatrix(piece.matrix,piece.pos); }

    function playerMove(dir){ piece.pos.x+=dir; if(collide(board,piece)) piece.pos.x-=dir; }
    function playerDrop(){ piece.pos.y++; if(collide(board,piece)){ piece.pos.y--; merge(board,piece); const cells=[]; piece.matrix.forEach((row,y)=>row.forEach((v,x)=>{ if(v){ cells.push({x:piece.pos.x+x,y:piece.pos.y+y,v}); }})); addLandingFlash(cells); sfx.lock(); clearLines(); newPiece(); } dropCounter=0; }
    function hardDrop(){ while(!collide(board,{matrix:piece.matrix,pos:{x:piece.pos.x,y:piece.pos.y+1},type:piece.type})) piece.pos.y++; playerDrop(); score+=2; updateUI(); }
    function playerRotate(dir){ const pos=piece.pos.x; let offset=1; rotate(piece.matrix,dir); while(collide(board,piece)){ piece.pos.x+=offset; offset=-(offset+(offset>0?1:-1)); if(offset>piece.matrix[0].length){ rotate(piece.matrix,-dir); piece.pos.x=pos; return; } } }

    function renderNext(){ elNext.innerHTML=''; const mat=createPiece(nextType); const box=4; const grid=[]; for(let y=0;y<box;y++) for(let x=0;x<box;x++) grid.push(0); for(let y=0;y<mat.length;y++) for(let x=0;x<mat[y].length;x++) grid[y*box+x]=mat[y][x]; grid.forEach(v=>{ const d=document.createElement('div'); d.className='sq'; d.style.background=v?COLORS[v]:'#0f172a'; elNext.appendChild(d); }); }

    function loop(time=0){ if(over){ drawBoard(); return; } const delta=time-lastTime; lastTime=time; if(!paused){ dropCounter+=delta; if(dropCounter>dropInterval){ playerDrop(); } drawBoard(); updateFx(delta); } requestAnimationFrame(loop); }

    window.addEventListener('keydown',(e)=>{ if(over) return; switch(e.code){ case 'ArrowLeft': playerMove(-1); sfx.move(); break; case 'ArrowRight': playerMove(1); sfx.move(); break; case 'ArrowDown': playerDrop(); score+=1; updateUI(); break; case 'ArrowUp': playerRotate(1); sfx.rotate(); break; case 'Space': e.preventDefault(); sfx.hard(); hardDrop(); break; case 'KeyP': case 'Pause': togglePause(); break; case 'KeyR': reset(); elState.textContent='遊戲中'; break; case 'KeyC': case 'KeyH': hold(); break; } });

    reset(); drawBoard();
  })();
  </script>
    <small>by Paddy臭迪小胖子 &copy;</small>
  </body>
</html>