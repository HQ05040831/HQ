<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>臭迪遊戲區｜太空戰爭</title>
  <style>
    :root{ --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; --link:#93c5fd; --border:rgba(255,255,255,.08); --container:1200px; }
    *{box-sizing:border-box}
    body{margin:0; line-height:1.6; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans TC','PingFang TC','Microsoft JhengHei',sans-serif; background:linear-gradient(120deg,#0b1220,#111827)}
    .container{max-width:var(--container); margin:0 auto; padding:0 16px}
    header{position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px); background:rgba(15,23,42,.75); border-bottom:1px solid var(--border); z-index:10}
    .nav{display:flex; align-items:center; justify-content:space-between; height:56px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 20px var(--accent)}
    nav ul{list-style:none; display:flex; gap:16px; padding:0; margin:0}
    nav a{display:inline-block; padding:6px 10px; border-radius:8px; text-decoration:none; color:var(--link); border:1px solid transparent}
    nav a:hover{border-color:var(--border); color:#fff}
    nav a.active{background:var(--accent); color:#052436; font-weight:700}
    .hero{padding:32px 0 12px}
    .hero h1{margin:0 0 6px; font-size:28px}
    .hero p{margin:0; color:var(--muted)}
    main{padding:12px 0 40px}
    .grid{display:grid; grid-template-columns: 1fr 300px; gap:20px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .game-wrap{padding:16px}
    .game-area{display:grid; grid-template-columns:auto 220px; gap:16px}
    @media (max-width:800px){ .game-area{grid-template-columns:1fr} }
    canvas{background:#0b1020; border-radius:12px; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
    .game-canvas-wrap{position:relative; width:320px; height:480px}
    .game-canvas-wrap canvas{position:absolute; left:0; top:0}
    .game-canvas-wrap .fx{pointer-events:none; mix-blend-mode:screen}
    .side{padding:12px 14px; border-radius:16px}
    .side h2{font-size:18px; margin:0 0 10px; color:#f8fafc}
    .stats{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:10px 0 12px}
    .stat{background:#0b1220; padding:10px; border-radius:10px; text-align:center}
    .stat b{display:block; font-size:22px; margin-top:2px; color:#fff}
    .controls{font-size:14px}
    .btns{display:flex; gap:8px; margin-top:10px}
    button{flex:1; padding:10px 12px; border:0; border-radius:10px; background:var(--accent); color:#052436; font-weight:700; cursor:pointer}
    button.secondary{background:#64748b; color:#0b1220}
    .note{opacity:.7; font-size:12px; margin-top:6px; text-align:center}
    .howto{padding:16px}
    .howto h3{margin:0 0 10px}
    .howto ul{margin:8px 0 0 16px; padding:0}
    footer{border-top:1px solid var(--border); color:#94a3b8; padding:14px 0 34px; text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="dot"></span>遊戲區</div>
      <nav>
        <ul>
          <li><a href="home.html">首頁</a></li>
          <li><a href="game.html">俄羅斯方塊</a></li>
          <li><a class="active" href="#">太空戰爭</a></li>
          <li><a href="game3.html">ZooKeeper</a></li>  
          <li><a href="home2.html">登出</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h1>臭迪遊戲區｜太空戰爭</h1>
      <p>← → 或 A / D 移動、Space 射擊、P 暫停、R 重開</p>
    </div>
  </section>

  <main class="container">
    <div class="grid">
      <section class="card game-wrap">
        <div class="game-area">
          <div class="game-canvas-wrap">
            <canvas id="game" width="320" height="480"></canvas>
            <canvas id="fx" width="320" height="480" class="fx"></canvas>
          </div>
          <aside class="card side">
            <h2>狀態面板</h2>
            <div class="stats">
              <div class="stat">分數<b id="score">0</b></div>
              <div class="stat">等級<b id="level">1</b></div>
              <div class="stat">生命<b id="lives">3</b></div>
              <div class="stat">狀態<b id="state">準備</b></div>
            </div>
            <div class="controls">
              <p><b>操作</b><br>← → 或 A / D 移動　Space 射擊　P 暫停　R 重開</p>
            </div>
            <div class="btns">
              <button id="btnStart">開始</button>
              <button id="btnPause" class="secondary">暫停</button>
            </div>
            <div class="note">Made with HTML5 Canvas + WebAudio</div>
          </aside>
        </div>
      </section>

      <aside class="card howto">
        <h3>玩法與規則</h3>
        <ul>
          <li>擊落敵機得分，累積分數升級，生成更快更密集。</li>
          <li>玩家共有 3 條生命，碰撞或漏怪到底即扣生命。</li>
          <li>擊破精英敵機有機率掉落道具（速射、三向）。</li>
        </ul>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container"><small>by Paddy臭迪小胖子 ©</small></div>
  </footer>

<script>
(function(){
  // ====== Canvas 與 UI ======
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const fx = document.getElementById('fx');
  const fxctx = fx.getContext('2d');
  const W = canvas.width, H = canvas.height;

  const elScore = document.getElementById('score');
  const elLevel = document.getElementById('level');
  const elLives = document.getElementById('lives');
  const elState = document.getElementById('state');
  document.getElementById('btnStart').addEventListener('click', start);
  document.getElementById('btnPause').addEventListener('click', togglePause);

  // ====== 影像素材（依檔名） ======
  const IMG = {
    ship: new Image(),
    enemy1: new Image(),
    enemy2: new Image(),
    bullet: new Image(),
    powerRapid: new Image(),
    powerTriple: new Image()
  };
  IMG.ship.src        = 'assets/ship.png';
  IMG.enemy1.src      = 'assets/enemy1.png';
  IMG.enemy2.src      = 'assets/enemy2.png';
  IMG.bullet.src      = 'assets/bullet.png';
  IMG.powerRapid.src  = 'assets/power_rapid.png';
  IMG.powerTriple.src = 'assets/power_triple.png';

  // 以中心點繪圖
  function drawCentered(img, x, y, w, h, rot=0){
    if(!img || !img.complete) return;
    ctx.save();
    ctx.translate(x, y);
    if(rot) ctx.rotate(rot);
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(img, -w/2, -h/2, w, h);
    ctx.restore();
  }

  // ====== WebAudio SFX ======
  const AC = window.AudioContext || window.webkitAudioContext; const audio = AC ? new AC() : null;
  function tone(freq=440, dur=0.06, type='square', gain=0.03){ if(!audio) return; const t=audio.currentTime; const o=audio.createOscillator(); const g=audio.createGain(); o.type=type; o.frequency.value=freq; o.connect(g); g.connect(audio.destination); g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(gain,t+0.005); g.gain.exponentialRampToValueAtTime(0.0001,t+dur); o.start(t); o.stop(t+dur); }
  function chord(freqs=[], dur=0.1, type='triangle', gain=0.03){ freqs.forEach(f=>tone(f,dur,type,gain)); }
  const sfx = { shoot: ()=>tone(880,0.05,'square',0.04), explode: ()=>chord([196,261.6],0.09,'triangle',0.04), hit: ()=>tone(220,0.05,'sawtooth',0.035), power: ()=>chord([523,659,784],0.12,'sine',0.035), level: ()=>chord([392,523,659],0.16,'triangle',0.04), lose: ()=>chord([220,196,174],0.25,'sawtooth',0.05) };

  // ====== 遊戲狀態 ======
  let running=false, paused=false, over=false;
  let score=0, level=1, lives=3, lastTime=0;
  let spawnTimer=0, spawnInterval=900; // ms
  let stars=[]; let bullets=[]; let enemies=[]; let powerups=[]; let particles=[];

  const COLORS = { player:'#38bdf8', enemy:'#f87171', elite:'#fbbf24', bullet:'#e5e7eb', star:'#334155', power:'#34d399' };

  const player = { x: W/2, y: H-50, w: 28, h: 28, speed: 240, cooldown: 0, fireRate: 180, mode: 'single', modeTimer: 0 };

  // ====== 輔助 ======
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function rectsOverlap(a,b){ return !(a.x+a.w<b.x || a.x>b.x+b.w || a.y+a.h<b.y || a.y>b.y+b.h); }
  function rand(a,b){ return a + Math.random()*(b-a); }

  // 粒子
  function addExplosion(x,y,color,n=24,spread=1.8){ for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2, sp=rand(1.2,2.8); particles.push({x,y,vx:Math.cos(a)*sp, vy:Math.sin(a)*sp, life:600, alpha:1, color}); } }
  function addSpark(x,y){ particles.push({x,y,vx:0,vy:-0.6,life:200,alpha:1,color:'#fff'}); }
  function drawFX(delta){
    fxctx.clearRect(0,0,W,H);
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.01; p.life-=delta; p.alpha=Math.max(0,p.life/600);
      fxctx.globalAlpha=p.alpha; fxctx.fillStyle=p.color; fxctx.fillRect(p.x-2,p.y-2,4,4);
      if(p.life<=0) particles.splice(i,1);
    }
    fxctx.globalAlpha=1;
  }

  // 星空
  function initStars(){ stars = Array.from({length:80},()=>({x:Math.random()*W,y:Math.random()*H,s:rand(0.5,1.8)})); }
  function updateStars(){ ctx.fillStyle='#0b1020'; ctx.fillRect(0,0,W,H); ctx.fillStyle=COLORS.star; stars.forEach(st=>{ st.y+=st.s*0.6; if(st.y>H){ st.y=0; st.x=Math.random()*W; } ctx.fillRect(st.x, st.y, 2, 2); }); }

  // ====== 流程 ======
  function reset(){ score=0; level=1; lives=3; spawnInterval=900; bullets=[]; enemies=[]; powerups=[]; particles=[]; player.x=W/2; player.y=H-50; player.cooldown=0; player.mode='single'; player.modeTimer=0; running=false; paused=false; over=false; initStars(); updateUI(); elState.textContent='準備'; }
  function start(){ if(over) reset(); running=true; paused=false; elState.textContent='遊戲中'; requestAnimationFrame(loop); }
  function togglePause(){ if(!running||over) return; paused=!paused; elState.textContent=paused?'暫停':'遊戲中'; }
  function gameOver(){ over=true; running=false; elState.textContent='結束'; sfx.lose(); }

  // 射擊（圖示子彈）
  function shoot(){ if(player.cooldown>0) return; player.cooldown = player.fireRate; sfx.shoot();
    const size = 14; const by = player.y - 14;
    if(player.mode==='triple'){
      bullets.push({x:player.x-8, y:by, w:size, h:size, vy:-360});
      bullets.push({x:player.x-1, y:by, w:size, h:size, vy:-360, vx:-90});
      bullets.push({x:player.x+6, y:by, w:size, h:size, vy:-360, vx:90});
    }else if(player.mode==='rapid'){
      bullets.push({x:player.x - size/2, y:by, w:size, h:size, vy:-420});
      player.cooldown = 90;
    }else{
      bullets.push({x:player.x - size/2, y:by, w:size, h:size, vy:-360});
    }
    addSpark(player.x, by);
  }

  // 敵人 / 道具
  function spawnEnemy(){
    const elite = Math.random()<Math.min(0.1+level*0.02, 0.35);
    const w = elite? 26:18, h = elite? 20:14;
    enemies.push({ x: rand(10,W-10-w), y:-h-4, w, h, hp: elite?3:1, vy: rand(40, 60)+level*6, type: elite?'elite':'enemy', score: elite?50:10 });
  }
  function tryDropPower(x,y){
    if(Math.random()<0.18){
      const kinds=['rapid','triple'];
      const kind=kinds[Math.floor(Math.random()*kinds.length)];
      const size=20;
      powerups.push({x, y, w:size, h:size, size, vy:80, kind});
    }
  }

  // 更新
  function update(delta){
    // 玩家
    const moveX = (keys['ArrowLeft']||keys['KeyA']?-1:0) + (keys['ArrowRight']||keys['KeyD']?1:0);
    player.x = clamp(player.x + moveX * player.speed * (delta/1000), 14, W-14);
    if((keys['Space']||keys['KeyJ']) && !paused && running) shoot();
    if(player.cooldown>0) player.cooldown -= delta;
    if(player.mode!=='single'){ player.modeTimer -= delta; if(player.modeTimer<=0){ player.mode='single'; } }

    // 子彈
    bullets.forEach(b=>{ b.y += b.vy * (delta/1000); b.x += (b.vx||0) * (delta/1000); });
    bullets = bullets.filter(b=> b.y>-20 && b.y<H+20);

    // 敵人
    enemies.forEach(e=>{ e.y += e.vy * (delta/1000); });
    enemies = enemies.filter(e=>{ if(e.y>H+10){ lives--; if(lives<=0) gameOver(); updateUI(); return false; } return true; });

    // 子彈 vs 敵人
    for(let i=enemies.length-1;i>=0;i--){
      const e=enemies[i];
      for(let j=bullets.length-1;j>=0;j--){
        const b=bullets[j];
        if(rectsOverlap(e,{x:b.x,y:b.y,w:b.w,h:b.h})){
          bullets.splice(j,1); e.hp--; sfx.hit(); addExplosion(b.x,b.y,'#fff',4,1);
          if(e.hp<=0){
            enemies.splice(i,1);
            addExplosion(e.x+e.w/2,e.y+e.h/2, e.type==='elite'? '#fbbf24':'#f87171', 28, 2);
            sfx.explode(); score += e.score;
            if(e.type==='elite') tryDropPower(e.x+e.w/2,e.y+e.h/2);
            updateUI();
          }
          break;
        }
      }
    }

    // 敵人撞玩家
    for(const e of enemies){
      if(rectsOverlap(e,{x:player.x-10,y:player.y-12,w:20,h:24})){
        addExplosion(player.x,player.y,'#38bdf8',30,2.2);
        enemies.splice(enemies.indexOf(e),1);
        lives--; if(lives<=0) gameOver(); updateUI(); break;
      }
    }

    // 道具移動 & 撿取
    powerups.forEach(p=>{ p.y += p.vy*(delta/1000); });
    for(let i=powerups.length-1;i>=0;i--){
      const p=powerups[i];
      // 玩家矩形（與上面一致）
      const playerRect = {x:player.x-10, y:player.y-12, w:20, h:24};
      // 道具矩形（由中心點 size 轉成矩形）
      const pRect = {x:p.x - p.size/2, y:p.y - p.size/2, w:p.size, h:p.size};
      if(rectsOverlap(pRect, playerRect)){
        powerups.splice(i,1);
        if(p.kind==='rapid'){ player.mode='rapid'; player.modeTimer=6000; }
        else if(p.kind==='triple'){ player.mode='triple'; player.modeTimer=6000; }
        sfx.power();
      } else if(p.y>H+20){
        powerups.splice(i,1);
      }
    }

    // 生成敵人
    spawnTimer += delta; if(spawnTimer>spawnInterval){ spawnEnemy(); spawnTimer = 0; }

    // 升級
    const newLevel = Math.floor(score/300)+1; if(newLevel>level){ level=newLevel; spawnInterval = Math.max(360, 900 - (level-1)*70); sfx.level(); updateUI(); }
  }

  // ====== 繪圖（全部用圖片；道具也換圖） ======
  function draw(){
    updateStars();

    // 玩家
    drawCentered(IMG.ship, player.x, player.y, player.w, player.h);

    // 子彈
    bullets.forEach(b=>{
      if(IMG.bullet.complete){ drawCentered(IMG.bullet, b.x + b.w/2, b.y + b.h/2, b.w, b.h); }
      else { ctx.fillStyle = COLORS.bullet; ctx.fillRect(b.x, b.y, b.w, b.h); }
    });

    // 敵人
    enemies.forEach(e=>{
      const img = (e.type==='elite') ? IMG.enemy2 : IMG.enemy1;
      if(img.complete){ drawCentered(img, e.x + e.w/2, e.y + e.h/2, Math.max(e.w,18), Math.max(e.h,18)); }
      else {
        ctx.save(); ctx.translate(e.x+e.w/2, e.y+e.h/2);
        ctx.fillStyle = (e.type==='elite')? '#fbbf24' : '#f87171';
        ctx.beginPath(); ctx.moveTo(-e.w/2,-e.h/2); ctx.lineTo(e.w/2,-e.h/2); ctx.lineTo(0,e.h/2); ctx.closePath(); ctx.fill(); ctx.restore();
      }
    });

    // 道具（圖片：rapid/triple）
    powerups.forEach(p=>{
      const img = p.kind==='rapid' ? IMG.powerRapid : IMG.powerTriple;
      if(img.complete){ drawCentered(img, p.x, p.y, p.size, p.size); }
      else { // 載入前備援
        ctx.fillStyle=COLORS.power; ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
        ctx.strokeStyle='#052436'; ctx.strokeRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
      }
    });
  }

  // 迴圈
  function loop(ts){ if(over) return; if(!running) return; const delta = ts - lastTime; lastTime = ts; if(!paused){ update(delta); draw(); drawFX(delta); } requestAnimationFrame(loop); }

  // UI
  function updateUI(){ elScore.textContent=score; elLevel.textContent=level; elLives.textContent=lives; }

  // 控制
  const keys={};
  window.addEventListener('keydown',e=>{ keys[e.code]=true; if(e.code==='Space') e.preventDefault(); if(!running && (e.code==='Space'||e.code==='Enter')) start(); });
  window.addEventListener('keyup',e=> keys[e.code]=false);

  // 啟動
  reset();
})();
</script>
</body>
</html>